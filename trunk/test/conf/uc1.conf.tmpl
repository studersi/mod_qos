#
# $Header: /home/cvs/m/mo/mod-qos/src/test/conf/uc1.conf.tmpl,v 2.4 2013-09-05 19:58:34 pbuchbinder Exp $
#
# mod_qos test configuration using mod_proxy
#
# See http://opensource.adnovum.ch/mod_qos/ for further
# details about mod_qos.
#
# Copyright (C) 2007-2010 Pascal Buchbinder
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
# MA 02110-1301, USA.
#

ServerName              127.0.0.1
<IfModule worker.c>
StartServers            1
ServerLimit             1
MinSpareThreads         5
MaxSpareThreads         64
ThreadsPerChild         64
</IfModule>
<IfModule prefork.c>
StartServers            64
ServerLimit             64
MinSpareServers         4
MaxSpareServers         64
</IfModule>

MaxClients              64
MaxRequestsPerChild     0

User                    ##USR##
Group                   users
ServerAdmin             webmaster@127.0.0.1
ServerRoot              ##ROOT##
DocumentRoot            ##ROOT##/htdocs
ServerSignature         off
HostnameLookups         off
UseCanonicalName        on
LockFile                ##ROOT##/logs/accept.lock
Timeout                 30
KeepAlive               on
MaxKeepAliveRequests    100
KeepAliveTimeout        5

LimitRequestFields      30
QS_EnableInternalIPSimulation off

Options                 FollowSymLinks Indexes Includes
DefaultType             text/plain
AddType                 text/html .shtml
AddOutputFilter         INCLUDES .shtml

LogFormat               "%h %l %u %t \"%r\" %>s %b \"%{User-Agent}i\" %T %{mod_qos_cr}e %{mod_qos_ev}e %{mod_qos_con}e id=%{UNIQUE_ID}e %{qs_special}e %{content-length}i #%P"

LogLevel                warn
ErrorLog                ##ROOT##/logs/error_log
TransferLog             "|##ROOT##/../util/src/qsrotate -o ##ROOT##/logs/access_log -z -g 4 -s 3600 -f"
CustomLog               "|##ROOT##/../util/src/qslog -o ##ROOT##/logs/qs_log -f ISBDUQ" "%h %>s %b %D %{mod_qos_user_id}e %{mod_qos_ev}o '%v:%U'"

PidFile                 ##ROOT##/logs/apache.pid
CoreDumpDirectory       ##ROOT##/logs/

TypesConfig             conf/mime.types
LoadModule              proxy_module ##ROOT##/../httpd/modules/proxy/.libs/mod_proxy.so
LoadModule              proxy_http_module ##ROOT##/../httpd/modules/proxy/.libs/mod_proxy_http.so
LoadModule              qos_module ##ROOT##/../httpd/modules/qos/.libs/mod_qos.so
LoadModule              parp_module libexec/mod_parp.so

<IfDefine uc1b>
QS_ClientEventLimitCount 3 3
QS_SetEnvIfQuery         QS_Limit QS_Limit=yes
QS_ErrorPage             /error-docs/error.html
</IfDefine>

NameVirtualHost         127.0.0.1:##QS_PORT_BASE##
Listen                  127.0.0.1:##QS_PORT_BASE##

<VirtualHost 127.0.0.1:##QS_PORT_BASE##>
   ServerName                 127.0.0.1

   ProxyRequests              Off
   <Proxy *>
      Order deny,allow
      Allow from all
   </Proxy>

   ProxyPass                  /error-docs !
   ProxyPass                  /status !
   ProxyPass                  /test !
   ProxyPass                  /a !
   ProxyPass                  /b !
   ProxyPass                  /c !
   ProxyPass                  /cgi-local !
   ProxyPass                  /htt http://localhost:##QS_PORT_BASE6##/htt retry=0
   ProxyPassReverse           /htt http://localhost:##QS_PORT_BASE6##/htt

   ScriptAlias /cgi-local/    ##ROOT##/htdocs/cgi-local/
   ScriptAlias /a/            ##ROOT##/htdocs/cgi-local/
   ScriptAlias /b/            ##ROOT##/htdocs/cgi-local/
   ScriptAlias /c/            ##ROOT##/htdocs/cgi-local/
   ScriptAlias /x/            ##ROOT##/htdocs/cgi-local/

<IfDefine uc1a>
   QS_LocRequestLimitMatch    "^(/htt/a/|/htt/b/|/htt/c/).*$" 2

   QS_SetEnvIfQuery           QueryLimit query
   QS_EventRequestLimit       query                           2
</IfDefine>

<IfDefine uc1c>
   QS_SetEnvIfQuery           Limit QS_Cond=1
   QS_CondLocRequestLimitMatch "^(/a/|/b/|/c/).*$" 2 [0-9]+
</IfDefine>

   <Location /cgi-local>
       Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
       Order allow,deny
       Allow from all
   </Location>

</VirtualHost>
