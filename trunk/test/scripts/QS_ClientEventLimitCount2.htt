#
# $Id: QS_ClientEventLimitCount2.htt,v 1.1 2013-09-01 20:06:50 pbuchbinder Exp $
#
# config enabled by QS_ClientEventLimitCount.htt!!!
#  QS_ClientEventLimitCount 100 600 QS_LimitVar4
#   QS_SetEnvIfQuery           QS_LimitVar4      QS_LimitVar4=yes
#   QS_RedirectIf        QS_LimitVar4_Counter (23) http://127.0.0.1/error.html?c=$1
#   QS_RedirectIf        MAXVAR425 (.*) $1
#   <Location /htt/soap>
#      SetEnvIfPlus      QS_LimitVar4_Counter 25 MAXVAR425=http://127.0.0.1/go late
#

INCLUDE scripts/ports

CLIENT

_LOOP 22
_REQ localhost $QS_PORT_BASE
__GET /qos/?trigger2=QS_LimitVar4 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "<title>mod_qos</title>"
_WAIT
_CLOSE
_END LOOP

# req 23
_REQ localhost $QS_PORT_BASE
__GET /qos/?trigger2=QS_LimitVar4 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "302 Found"
_EXPECT . "Location: http://127.0.0.1/error.html\?c=23"
_WAIT
_CLOSE
_SLEEP 200
_EXPECT EXEC "mod_qos\(049\): redirect to http://127.0.0.1/error.html\?c=23, var=QS_LimitVar4_Counter, action=redirect, c=127.0.0.1"
_EXEC tail -1 logs/error_log

# req 24
_REQ localhost $QS_PORT_BASE
__GET /qos/?trigger2=QS_LimitVar4 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "<title>mod_qos</title>"
_WAIT
_CLOSE

# req 25
_REQ localhost $QS_PORT_BASE
__GET /htt/soap/?trigger2=QS_LimitVar4 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "Location: http://127.0.0.1/go"
_WAIT
_CLOSE

END
