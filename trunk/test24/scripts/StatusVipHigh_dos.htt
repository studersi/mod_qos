
INCLUDE scripts/ports

CLIENT
_SLEEP 200
_REQ localhost $QS_PORT_BASE
__GET /htt/login HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "Login Success"
_WAIT
_CLOSE

_REQ localhost $QS_PORT_BASE
__GET /index.html HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_WAIT
_CLOSE

_LOOP 20
_REQ localhost $QS_PORT_BASE
__GET /xxx HTTP/1.1
__Host: localhost
__
_EXPECT . "Service Unavailable"
_WAIT
_CLOSE
_END LOOP

_EXPECT ERROR "Connection reset by peer"
_REQ localhost $QS_PORT_BASE
_CLOSE
_SLEEP 100
_EXPECT EXEC "mod_qos.060.: access denied, QS_ClientEventBlockCount rule: max=20"
_EXEC tail -3 logs/error_log

END

SERVER $QS_PORT_BASE6
_RES
_WAIT
__HTTP/1.1 200 OK
__Content-Type: text/html
__Content-Length: AUTO
__login: valid
__
__<html>
__<head><title>Login Success</title></head>
__<body>
__</body>
__</html>
_CLOSE

END

CLIENT 10
_REQ localhost $QS_PORT_BASE
__GET /cgi-local/sleep.cgi HTTP/1.1
__Host: localhost
__
_EXPECT . "done"
_WAIT
_CLOSE
END
