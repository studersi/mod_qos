#!/bin/sh
# -*-mode: ksh; ksh-indent: 2; -*-
#
# test ip store by adding entries via console
#

cd `dirname $0`
. ./ports
URLIN="http://127.0.0.1:$QS_PORT_BASE/console"

LIST="106.120.82.0 224.12.28.2 118.211.40.10 188.229.40.11 54.158.233.12 60.139.175.17 246.144.109.29 188.24.61.30 74.96.69.39 80.161.20.40 204.204.81.40 32.186.57.41 10.235.177.58 124.14.28.63 220.245.205.64 250.239.241.74 66.192.152.86 70.175.127.91 22.80.206.99 146.132.54.101 226.118.14.102 136.78.194.103 14.195.69.112 176.90.43.116 214.127.141.123 66.55.220.124 60.57.194.148 90.229.47.155 154.199.70.163 200.203.191.171 60.101.65.172 32.84.96.173 234.81.221.177 162.242.197.178 162.205.222.188 190.140.23.189 130.249.17.190 174.25.114.197 162.151.193.203 198.112.207.206 42.131.186.217 52.198.36.219 16.168.5.232 54.242.0.235 156.6.214.238 124.204.71.239 200.165.225.239 236.144.41.240 196.62.65.247 215.174.79.1 193.75.94.3 205.201.221.7 57.16.202.12 21.156.48.13 229.10.12.23 1.54.195.30 41.168.239.31 55.235.166.33 81.87.54.36 219.162.205.37 113.66.71.38 199.158.168.42 221.124.187.54 177.68.157.71 7.129.106.77 249.78.40.80 53.193.108.80 157.34.73.87 125.64.189.88 227.26.2.89 213.152.235.89 13.172.192.99 215.79.84.105 151.35.118.110 79.17.105.119 27.206.234.119 117.71.225.122 13.1.148.124 171.33.168.135 39.57.159.137 27.207.226.143 167.150.7.146 19.113.43.150 105.144.108.157 75.112.203.163 225.70.251.163 37.141.103.164 11.107.24.167 51.238.224.167 105.160.0.169 95.12.40.173 213.64.92.173 211.56.93.176 247.234.139.176 81.54.151.176 15.136.34.189 179.73.12.195 165.227.207.201 61.108.225.205 105.74.221.209 153.151.152.216 91.248.8.234 57.164.45.234 87.5.195.236 93.205.216.236 121.24.156.242 119.154.108.252"

# add entries
for E in $LIST; do
  wget "${URLIN}?action=setvip&address=$E" -O stack.txt -o /dev/null
done

# veriy they exist
for E in $LIST; do
  wget "${URLIN}?action=search&address=$E" -O stack.txt -o /dev/null
  if [ `grep -c "not available" stack.txt` -gt 0 ]; then
    echo "ERROR, missing entry $E"
    exit 1
  fi
  if [ `grep -c "${E}: " stack.txt` -eq 0 ]; then
    echo "ERROR, missing entry $E"
    exit 1
  fi
done

# verify our test
E="123.123.123.123"
wget "${URLIN}?action=search&address=$E" -O stack.txt -o /dev/null
if [ `grep -c "not available" stack.txt` -eq 0 ]; then
  echo "ERROR, entry $E"
  exit 1
fi
if [ `grep -c "${E}: " stack.txt` -ne 0 ]; then
  echo "ERROR, entry $E available"
  exit 1
fi

rm stack.txt
exit 0
