INCLUDE scripts/ports

CLIENT

_REQ localhost $QS_PORT_BASE
__GET /index.html HTTP/1.1
__Host: localhost
__
_EXPECT . "302"
_EXPECT . "Location: http://127.0.0.1:${QS_PORT_BASE}/error-docs/cookie.html"
_MATCH headers "Set-Cookie: utc=(.*); Path=/" UTC
_MATCH headers "Location: http://127.0.0.1:${QS_PORT_BASE}(.*)" LOC
_WAIT
_CLOSE
_SLEEP 100
# ensure we use the id generated by mod_unique_id, example: UpSoTX8AAQEAAFXuAPcAAAAy
_EXPECT EXEC "GET /index.html HTTP/1.1\" 302 ... \"-\" 0 - - - id=[a-zA-Z0-9_@-]{24,24} "
_EXEC tail -1 logs/access_log

_REQ localhost $QS_PORT_BASE
__GET $LOC HTTP/1.1
__Host: localhost
__Cookie: utc=$UTC
__
_EXPECT . "302"
_EXPECT . "Location: http://127.0.0.1:${QS_PORT_BASE}/index.html"
_EXPECT . "!Set-Cookie"
_MATCH headers "Location: http://127.0.0.1:${QS_PORT_BASE}(.*)" LOC
_WAIT
_CLOSE

_REQ localhost $QS_PORT_BASE
__GET $LOC HTTP/1.1
__Host: localhost
__Cookie: utc=$UTC
__
_EXPECT . "200 OK"
_EXPECT . "this is the root index.html"
_WAIT

END
