#
# $Id: 029_QS_SrvMaxConn.htt,v 1.2 2013-10-29 07:35:25 pbuchbinder Exp $
#
#   QS_SrvMaxConn              45
#

INCLUDE scripts/ports

CLIENT 45

_REQ localhost $QS_PORT_BASE
__GET /cgi/sleep.cgi?s=3 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "done"
_EXPECT . "200 OK"
_WAIT
_CLOSE
_SLEEP 10000
END

CLIENT 1

_SLEEP 2000
_REQ localhost $QS_PORT_BASE
__GET /cgi/sleep.cgi?s=3 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "500 Internal Server Error"
_WAIT
_CLOSE
_SLEEP 200
_EXPECT EXEC "mod_qos\(030\): access denied, QS_SrvMaxConn rule: max=45, concurrent connections=46"
_EXEC tail -1 logs/error_log

_SLEEP 14000
_REQ localhost $QS_PORT_BASE
__GET /cgi/sleep.cgi?s=3 HTTP/1.1
__Host: localhost
__Connection: keep-alive
__
_EXPECT . "done"
_EXPECT . "200 OK"
_WAIT

END
